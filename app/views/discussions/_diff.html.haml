- diff_file = discussion.diff_file
- discussions = { discussion.original_line_code => [discussion] }

.file-header-content
  = render "projects/diffs/file_header", diff_file: diff_file, url: discussion_path(discussion), show_toggle: false

  - if diff_file.text?
    .diff-content.code.js-syntax-highlight
      %table
        = render partial: "projects/diffs/line",
          collection: discussion.truncated_diff_lines,
          as: :line,
          locals: { diff_file: diff_file,
            discussions: discussions,
            discussion_expanded: true,
            plain: true }
  - else
    - partial = (diff_file.new_file? || diff_file.deleted_file?) ? 'single_image_diff' : 'replaced_image_diff'

    = render partial: "projects/diffs/#{partial}", locals: { diff_file: diff_file, position: discussion.position.to_json, click_to_comment: false }
