- diff_file = discussion.diff_file
- blob = discussion.blob
- discussions = { discussion.original_line_code => [discussion] }
- diff_file_class = diff_file.text? ? 'text-file' : 'js-image-file'

.diff-file.file-holder{ class: diff_file_class }
  .js-file-title.file-title.file-title-flex-parent
    .file-header-content
      = render "projects/diffs/file_header", diff_file: diff_file, url: discussion_path(discussion), show_toggle: false

  - if diff_file.text?
    .diff-content.code.js-syntax-highlight
      %table
        = render partial: "projects/diffs/line",
          collection: discussion.truncated_diff_lines,
          as: :line,
          locals: { diff_file: diff_file,
            discussions: discussions,
            discussion_expanded: true,
            plain: true }
  - else

    - locals = { diff_file: diff_file, position: discussion.position.to_json, click_to_comment: false }
    - if diff_file.new_file? || diff_file.deleted_file?
      = render partial: "projects/diffs/single_image_diff", locals: locals
    - else
      = render partial: "projects/diffs/replaced_image_diff", locals: locals

    .note-container
      = render partial: "discussions/notes", locals: { discussion: discussion, show_toggle: false, show_image_comment_badge: true, disable_collapse: true }
