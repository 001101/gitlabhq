- affix_offset = local_assigns.fetch(:affix_offset, "102")
- project = local_assigns[:project]

%aside.right-sidebar.js-right-sidebar{ data: { "offset-top" => affix_offset, "spy" => "affix" }, class: sidebar_gutter_collapsed_class, 'aria-live' => 'polite' }
  .issuable-sidebar
    .block.issuable-sidebar-header
      %a.gutter-toggle.pull-right.js-sidebar-toggle{ role: "button", href: "#", "aria-label" => "Toggle sidebar" }
        = sidebar_gutter_toggle_icon

      %span.issuable-header-text.hide-collapsed
        Milestone #{milestone.try(:to_reference) || milestone.title}

    - if project
      .block.due_date
        .sidebar-collapsed-icon
          = icon('calendar', 'aria-hidden': 'true')
          %span.js-due-date-sidebar-value
            = milestone.due_date.try(:to_s, :medium) || 'None'
        .title.hide-collapsed
          Due date
          - if can?(current_user, :admin_milestone, @project)
            = link_to 'Edit', edit_namespace_project_milestone_path(@project.namespace, @project, @milestone), class: 'edit-link pull-right'
        .value.hide-collapsed
          %span.value-content
            - if milestone.due_date
              %span.bold= milestone.due_date.to_s(:medium)
            - else
              %span.no-value No due date
          - remaining_days = milestone_remaining_days(milestone)
          - if remaining_days.present?
            = surround '(', ')' do
              %span.remaining-days= remaining_days

    - milestone_ref = milestone.try(:to_reference, full: true)
    - if milestone_ref.present?
      .block
        .sidebar-collapsed-icon.dont-change-state
          = clipboard_button(clipboard_text: milestone_ref, title: "Copy reference to clipboard", placement: "left")
        .cross-project-reference.hide-collapsed
          %span
            Reference:
            %cite{ title: milestone_ref }
              = milestone_ref
          = clipboard_button(clipboard_text: milestone_ref, title: "Copy reference to clipboard", placement: "left")
