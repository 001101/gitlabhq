- show_roles = local_assigns.fetch(:show_roles, true)
- show_controls = local_assigns.fetch(:show_controls, true)
- user = member.request? ? member.created_by : member.user

%li.js-toggle-container{ class: dom_class(member), id: dom_id(member) }
  %span{ class: ("list-item-name" if show_controls) }
    - if user
      = image_tag avatar_icon(user, 24), class: "avatar s24", alt: ''
      %strong
        = link_to user.name, user_path(user)
      %span.cgray= user.username

      - if user == current_user
        %span.label.label-success It's you

      - if user.blocked?
        %label.label.label-danger
          %strong Blocked

      - if member.request?
        %small
          â€“ Requested
          = time_ago_with_tooltip(member.requested_at)
    - else
      = image_tag avatar_icon(member.invite_email, 24), class: "avatar s24", alt: ''
      %strong= member.invite_email
      %span.cgray
        invited
        - if member.created_by
          by
          = link_to member.created_by.name, user_path(member.created_by)
        = time_ago_with_tooltip(member.created_at)

      - if show_controls && can?(current_user, action_member_permission(:admin, member), member.source)
        = link_to 'Resend invite', resend_invite_member_path(member),
                  method: :post,
                  class: 'btn-xs btn'

  - if show_roles && can_see_entity_roles?(current_user, member.source)
    %span.pull-right
      %strong= member.human_access
      - if show_controls
        - if can?(current_user, action_member_permission(:update, member), member)
          = button_tag icon('pencil'),
                       type: 'button',
                       class: 'btn-xs btn btn-grouped inline js-toggle-button',
                       title: 'Edit access level'

          - if member.request?
            &nbsp;
            = link_to icon('check inverse'), approve_request_member_path(member),
                      method: :post,
                      type: 'button',
                      class: 'btn-xs btn btn-success',
                      title: 'Grant access'

        - if can?(current_user, action_member_permission(:destroy, member), member)
          &nbsp;
          - if current_user == user
            = link_to leave_path(member.source), data: { confirm: leave_confirmation_message(member.source)}, method: :delete, class: "btn-xs btn btn-remove", title: 'Remove user from group' do
              = icon("sign-out")
              Leave
          - else
            = link_to icon('trash'), member_path(member),
                      method: :delete,
                      remote: true,
                      data: { confirm: remove_member_message(member) },
                      class: 'btn-xs btn btn-remove',
                      title: remove_member_title(member)

    .edit-member.hide.js-toggle-content
      %br
      = form_for member_path(member), as: "#{member.source.class.to_s.underscore}_member".to_sym, remote: true do |f|
        .prepend-top-10
          = f.select :access_level, options_for_select(member_class(member).access_level_roles, member.access_level), {}, class: 'form-control'
        .prepend-top-10
          = f.submit 'Save', class: 'btn btn-save btn-sm'
