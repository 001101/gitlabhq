%script#environment-item-template{ "type"=> "text/x-template" }
  %tr.environment
    %td.environment-folder-name{ "@click" => "toggle" }
      %a{ "v-if" => "!isFolder", 
        ":href" => "'#{namespace_project_environments_path(@project.namespace, @project)}/' + model.id" }
        {{model.name}}
        
      %span{ "v-if" => "isFolder" }
        %i{ "v-show" => "open" }
          = icon("caret-down")

        %i{ "v-show" => "!open" }
          = icon("caret-right")



    %td.deployment-column
      %span{ "v-if" => "!isFolder && model.last_deployment && model.last_deployment.iid" }
        {{model.last_deployment.iid}}

        by
        %span{ "v-if" => "model.last_deployment.user" }
          {{model.last_deployment.user.name}}

    %td
      %a{ "v-if" => "!isFolder" }
        column 3

    %td
      %a{ "v-if" => "!isFolder" }
        column 3

    %td 
      %span{ "v-if" => "!isFolder && model.last_deployment" }
        {{last_deployment.created_at}}

    %td.hidden-xs
      .pull-right
        actions
        -# = render 'projects/environments/external_url', environment: "model"
        -# = render 'projects/deployments/actions', deployment: "model.last_deployment"
        -# = render 'projects/environments/stop', environment: "model"
        -# = render 'projects/deployments/rollback', deployment: "model.last_deployment"
        
  %tr.environment-children{ "v-show" => "open", 
    "v-if"=>"isFolder", 
    "v-for" => "child in model.children", 
    ":model" => "child" }

    %td
      %a{ ":href" => "'#{namespace_project_environments_path(@project.namespace, @project)}/' + child.id" }
        {{child.name}}
  
    %td.deployment-column
      %span{ "v-if" => "child.last_deployment && child.last_deployment.iid" }
        {{child.last_deployment.iid}}
      %span{ "v-if" => "child.last_deployment && child.last_deployment.user" }
        {{child.last_deployment.user}}
        /= user_avatar(user: "child.last_deployment.user", size: 20)

    %td
      %a.build-link{ "v-if" => "child.last_deployment && child.last_deployment.deployable",
        ":href" => "" }
        {{child.last_deployment}}

    %td
      column 4

    %td 
      column 5

    %td.hidden-xs
      .pull-right
        actions