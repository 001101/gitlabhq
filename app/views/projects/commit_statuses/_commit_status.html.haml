%tr.commit_status
  %td.status
    = ci_status_with_icon(commit_status.status)

  %td.commit_status-link
    - if commit_status.target_url
      = link_to commit_status.target_url do
        %strong Build ##{commit_status.id}
    - else
      %strong Build ##{commit_status.id}

  - if defined?(ref)
    %td
      = commit_status.ref

  %td
    = commit_status.stage

  %td
    = commit_status.description
    .pull-right
      - if commit_status.tags.any?
        - commit_status.tags.each do |tag|
          %span.label.label-primary
            = tag
      - if commit_status.try(:trigger_request)
        %span.label.label-info triggered
      - if commit_status.try(:allow_failure)
        %span.label.label-danger allowed to fail

  %td.duration
    - if commit_status.duration
      #{duration_in_words(commit_status.finished_at, commit_status.started_at)}

  %td.timestamp
    - if commit_status.finished_at
      %span #{time_ago_in_words commit_status.finished_at} ago

  - if defined?(coverage)
    %td.coverage
      - if commit_status.try(:coverage)
        #{commit_status.coverage}%

  %td
    - if defined?(controls) && current_user && can?(current_user, :manage_builds, gl_project)
      .pull-right
        - if commit_status.active?
          = link_to cancel_namespace_project_build_path(gl_project.namespace, gl_project, commit_status, return_to: request.original_url), title: 'Cancel commit_status' do
            %i.fa.fa-remove.cred
        - elsif commit_status.commands.present?
          = link_to retry_namespace_project_build_path(gl_project.namespace, gl_project, commit_status, return_to: request.original_url), method: :post, title: 'Retry commit_status' do
            %i.fa.fa-repeat
