%h3.page-title
  New Merge Request

= form_for [@project.namespace.becomes(Namespace), @project, @merge_request], url: new_namespace_project_merge_request_path(@project.namespace, @project), method: :get, html: { class: "merge-request-form form-inline js-requires-input" } do |f|
  .hide.alert.alert-danger.mr-compare-errors
  .merge-request-branches.row
    .col-md-6
      .panel.panel-default.panel-new-merge-request
        .panel-heading
          Source branch
        .panel-body.clearfix
          .merge-request-select
            = f.select(:source_project_id, [[@merge_request.source_project_path,@merge_request.source_project.id]] , {}, { class: 'source_project select2', disabled: @merge_request.persisted?, required: true })
          .merge-request-select
            = f.select(:source_branch, @merge_request.source_branches, { include_blank: true }, { class: 'source_branch select2', required: true, data: { placeholder: "Select source branch" } })
        .panel-footer
          = icon('spinner spin', class: "js-source-loading")
          %ul.list-unstyled.mr_source_commit

    .col-md-6
      .panel.panel-default.panel-new-merge-request
        .panel-heading
          Target branch
        .panel-body.clearfix
          - projects =  @project.forked_from_project.nil? ? [@project] : [@project, @project.forked_from_project]
          .merge-request-select
            = f.select(:target_project_id, options_from_collection_for_select(projects, 'id', 'path_with_namespace', f.object.target_project_id), {}, { class: 'target_project select2', disabled: @merge_request.persisted?, required: true })
          .merge-request-select
            = f.select(:target_branch, @merge_request.target_branches, { include_blank: true }, { class: 'target_branch select2', required: true, data: { placeholder: "Select target branch" } })
        .panel-footer
          = icon('spinner spin', class: "js-target-loading")
          %ul.list-unstyled.mr_target_commit

  - if @merge_request.errors.any?
    .alert.alert-danger
      - @merge_request.errors.full_messages.each do |msg|
        %div= msg

  - elsif @merge_request.source_branch.present? && @merge_request.target_branch.present?
    .light-well.append-bottom-default
      .center
        %h4
          There isn't anything to merge.
        %p.slead
          - if @merge_request.source_branch == @merge_request.target_branch
            You'll need to use different branch names to get a valid comparison.
          - else
            %span.label-branch #{@merge_request.source_branch}
            and
            %span.label-branch #{@merge_request.target_branch}
            are the same.
  = f.submit 'Compare branches and continue', class: "btn btn-new mr-compare-btn"

:javascript
  new Compare({
    targetProjectUrl: "#{update_branches_namespace_project_merge_requests_path(@source_project.namespace, @source_project)}",
    sourceBranchUrl: "#{branch_from_namespace_project_merge_requests_path(@source_project.namespace, @source_project)}",
    targetBranchUrl: "#{branch_to_namespace_project_merge_requests_path(@source_project.namespace, @source_project)}"
  });
