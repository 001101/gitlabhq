- if note.valid?
  - if note.for_wall?
    NoteList.appendNewWallNote(#{note.id}, "#{escape_javascript(render "notes/note", note: note)}");
  - else
    NoteList.appendNewNote(#{note.id}, "#{escape_javascript(render "notes/note", note: note)}");

- else
  -# TODO: insert form correctly
  $(".js-main-target-note").replaceWith("#{escape_javascript(render 'notes/common_form')}");
  GitLab.GfmAutoComplete.setup();
