!function(e){function t(r){if(i[r])return i[r].exports;var n=i[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var i={};t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,r){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=11)}({11:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={init:function(e){this.destroyed=!1,this.hook=e,this.notLoading(),this.eventWrapper={},this.eventWrapper.debounceTrigger=this.debounceTrigger.bind(this),this.hook.trigger.addEventListener("keydown.dl",this.eventWrapper.debounceTrigger),this.hook.trigger.addEventListener("focus",this.eventWrapper.debounceTrigger),this.trigger(!0)},notLoading:function(){this.loading=!1},debounceTrigger:function(e){var t=[16,17,18,20,37,38,39,40,91,93],i=t.indexOf(e.detail.which||e.detail.keyCode)>-1,r="focus"===e.type;i||this.loading||(this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(this.trigger.bind(this,r),200))},trigger:function(e){var t=this.hook.config.droplabAjaxFilter,i=this.trigger.value;if(t&&t.endpoint&&t.searchKey){if(t.searchValueFunction&&(i=t.searchValueFunction()),t.loadingTemplate&&void 0===this.hook.list.data||0===this.hook.list.data.length){var r=this.hook.list.list.querySelector("[data-dynamic]"),n=document.createElement("div");n.innerHTML=t.loadingTemplate,n.setAttribute("data-loading-template",!0),this.listTemplate=r.outerHTML,r.outerHTML=n.outerHTML}if(e&&(i=""),t.searchKey===i)return this.list.show();this.loading=!0;var o=t.params||{};o[t.searchKey]=i;var a=this;a.cache=a.cache||{};var s=t.endpoint+this.buildParams(o),u=a.cache[s];u?a._loadData(u,t,a):this._loadUrlData(s).then(function(e){a._loadData(e,t,a)})}},_loadUrlData:function(e){var t=this;return new Promise(function(i,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.onreadystatechange=function(){if(n.readyState===XMLHttpRequest.DONE){if(200===n.status){var o=JSON.parse(n.responseText);return t.cache[e]=o,i(o)}return r([n.responseText,n.status])}},n.send()})},_loadData:function(e,t,i){var r=i.hook.list;if(t.loadingTemplate&&void 0===r.data||0===r.data.length){var n=r.list.querySelector("[data-loading-template]");n&&(n.outerHTML=i.listTemplate)}if(!i.destroyed){var o=r.list.children;1===o.length&&o[0].hasAttribute("data-dynamic")&&0===e.length&&r.hide(),r.setData.call(r,e)}i.notLoading(),r.currentIndex=0},buildParams:function(e){return e?"?"+Object.keys(e).map(function(t){return t+"="+(e[t]||"")}).join("&"):""},destroy:function(){this.timeout&&clearTimeout(this.timeout),this.destroyed=!0,this.hook.trigger.removeEventListener("keydown.dl",this.eventWrapper.debounceTrigger),this.hook.trigger.removeEventListener("focus",this.eventWrapper.debounceTrigger)}};window.droplabAjaxFilter=r,t.default=r}});
//# sourceMappingURL=ajax_filter.js.map