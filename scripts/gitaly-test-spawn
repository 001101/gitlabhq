#!/usr/bin/env ruby

require_relative 'gitaly-test-env'
include GitalyTest

# For CI debugging purposes
system(env, 'bundle', 'config', chdir: gitaly_ruby_dir)

check_gitaly_config!

# # Uncomment to see all gitaly logs in CI
# spawn('sleep 1; tail -f log/gitaly-test.log')

# Print the PID of the spawned process. This value is used by rspec.
pid = spawn(env, *args, [:out, :err] => 'log/gitaly-test.log')
IO.write(File.expand_path('../tmp/tests/gitaly.pid', __dir__), pid)
