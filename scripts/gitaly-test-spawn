#!/usr/bin/env ruby

# This script is used both in CI and in local development 'rspec' runs.

require_relative 'gitaly-test-env'
include GitalyTest

check_gitaly_config!

# # Uncomment line below to see all gitaly logs merged into CI trace
# spawn('sleep 1; tail -f log/gitaly-test.log')

pid = spawn(env, *args, [:out, :err] => 'log/gitaly-test.log')

# In local development rspec runs this pid file is used by rspec.
IO.write(File.expand_path('../tmp/tests/gitaly.pid', __dir__), pid)
